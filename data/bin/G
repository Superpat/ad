#!/usr/bin/env bash
# "grep open"
#
# Run ripgrep to search for a pattern under the current file directory
source "$HOME/.ad/lib/ad.sh"

requireAd
[[ -z "$*" ]] && adError "need a pattern to grep for"
pat="$*"

dirname="$(dirname "$(bufRead "$bufid" filename)")"
cd "$dirname" || exit
rg "$pat" \
  --column \
  --line-number \
  --no-heading |
    sed 's/\(.\+\):\([0-9]\+\):\([0-9]\+\):/\1:\2:\3 /g'
